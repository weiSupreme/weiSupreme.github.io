
<body>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>weiSupreme</title>
	<link rel="icon" href="/assets/images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
    <![endif]-->
    <!--[if lt IE 9]>
       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css">


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-custom navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">weiSupreme</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    
                    <li class="active"><a href="/">Home</a></li>
                    <li class="active"><a href="/
archive.html">Archive</a></li>
                    <li class="active"><a href="/categories.html">Categories</a></li>
                    <li class="active"><a href="/tags.html">Tags</a></li>
                    <li class="active"><a href="/about.html">About</a></li>
                    <li class="active"><a href="/baidu_verify_09521yHBz8.html"></a></li>
                    <li class="active"><a href="/google57955228e7781956.html"></a></li>
<img src="/assets/images/me.gif"
                </u1>
            </div>
        </div>
    </div>
</div>


<div class="wrap">
    <div class="container container-left">
        <div class="row">
            <div class="col-md-3 hidden-xs">
                
<div class="sidebar well">
    <header class="sidebar-header" role="banner">
        <a href="/"> 
            <img src="/assets/images/logo.png" class="img-circle" />
        </a>
        <!--
        <h3 class="title">
        <a href="/"></a>
        </h3>
        -->
    </header>
    <div class="text-center">
        zhuwei的个人网站！
    </div>
</div>


<div class="sidebar well">
    <h1>Top Posts</h1>
    <ul>
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/material/2017/11/08/Deep-Learning-materials.html">深度学习入门资料汇总</a></li>
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/tutorial/2017/11/08/caffe-installation-without-gpu.html">caffe的安装步骤（无GPU版）</a></li>
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
                    <li><a href="/tutorial/2018/05/20/ubuntu16.04-cuda8.0-cudnn5.1.html">ubuntu16.04安装cuda8.0和cudnn5.1</a></li>
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
    </ul>
</div>


<div class="sidebar well">
    
<h1>Sources</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
</ul>

    <li class="active"><a href="/notes.html">Notes</a></li>
    <li class="active"><a href="/scripts.html">Scripts</a></li>
</div>

<div class="sidebar well">
    
<h1>Links</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="https://github.com/weiSupreme">
      Projects
    </a>
  </li> 
  
  <li>
    <a href="http://blog.csdn.net/wei_supreme">
      CSDN
    </a>
  </li> 
  
  <li>
    <a href="https://pan.baidu.com/s/1vMbOTDVNrT_NOq6uQJlJfQ">
      Papers
    </a>
  </li> 
  
  <li>
    <a href="http://www.pchou.info/ssgithubPage/2013-01-03-build-github-blog-page-01.html">
      GithubPages Tutorial
    </a>
  </li> 
  
  <li>
    <a href="https://analytics.google.com/analytics/web/?authuser=0#/realtime/rt-overview/a120200144w177741658p176372840/filter.list=33==DESKTOP;/">
      Google Analytics
    </a>
  </li> 
  
</ul>

</div>

<div class="sidebar well">
    
<h1>No Click</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="404">
      不要点
    </a>
  </li> 
  
</ul>

</div>


            </div>
            <div class="col-md-9">
                
<div class="well article">
        <h2><a href="/material/2018/01/28/python-scripts.html">python代码</a></h2>
        <span class="post-date">
            
            2018年-01月-28日
        </span>
        <hr style="border-top:1px solid #28323C;"/>
    
    <div class="post-content">
    <h3 id="1图像增强对颜色分量进行处理">1、图像增强（对颜色分量进行处理）</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import os
		import cv2
		import numpy as np

		dir = r"JPEGImages/"
		list = os.listdir(dir)
		cnt =0

		for i in range(0, len(list)):
			print(list[i])
			img = cv2.imread(dir+list[i])
			img_tmp = img.copy()
			img2 = img.copy()
			img_tmp = img_tmp.dot((0.05, 0.35, 0.6))
			#print(img_tmp.shape)
			img[:,:,0] = img_tmp
			#img[:,:,1] = img_tmp
			#img[:,:,2] = img_tmp
			#print(img.shape)
			#cv2.imshow('img', img)
			#cv2.imshow('aug', img2)
			#cv2.waitKey(0)
			cv2.imwrite(r"aug/"+list[i], img)
			cnt = cnt + 1
		print(cnt)
</code></pre></div></div>

<h3 id="2生成标签文件将csv格式的文件存储的标签数据转换为固定格式的txt文件或者将数据处理后写入到新的csv格式文件">2、生成标签文件。将csv格式的文件存储的标签数据转换为固定格式的txt文件或者将数据处理后写入到新的csv格式文件</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import csv
		import os

		dir = r"test-annotations-csv/"
		list = os.listdir(dir)

		flag = 0
		category = 'apple'
		top_left_x = 0
		top_left_y = 0
		bottom_right_x = 0
		bottom_right_y = 0

		txt = open("label.txt", 'w')

		for i in range(0,len(list)):  #len(list)
			img_file_name = list[i].rstrip('.csv') + '.png'
			print(img_file_name)
			path = os.path.join(dir,list[i])
			new_csv = open(r'aug_label_csv_test/'+list[i], 'w', newline='')
			writer = csv.writer(new_csv)
			writer.writerow(['#item', 'c-x', 'c-y', 'radius', 'label'])
			if os.path.isfile(path):
				out = open(path,'r')
				read_csv = csv.reader(out,dialect='excel')
				for line in read_csv:     #循环输出csv中的所有数据
					if flag == 0:
						flag = flag + 1
						continue
					flag = flag + 1
					#print(line)
					if line[4] == '1':
						category = 'apple'
						top_left_x = (int)(float(line[1]) + float(line[3])) if (int)(float(line[1]) + float(line[3])) &lt; 307 else 307
						top_left_x = 308 - top_left_x
						top_left_y = (int)(float(line[2]) - float(line[3])) if (int)(float(line[2]) - float(line[3])) &gt; 1 else 1
						bottom_right_x = (int)(float(line[1]) - float(line[3])) if (int)(float(line[1]) - float(line[3])) &gt; 0 else 0
						bottom_right_x = 308 - bottom_right_x
						bottom_right_y = (int)(float(line[2]) + float(line[3])) if (int)(float(line[2]) + float(line[3])) &lt; 202 else 202
						write_str = img_file_name + ' ' + category + ' ' + str(top_left_x) +' ' + str(top_left_y) + ' ' + str(bottom_right_x) + ' ' + str(bottom_right_y) + '\n'
						txt.write(write_str)
						c_x = float((top_left_x+bottom_right_x)/2)
						c_y = float((top_left_y+bottom_right_y)/2)
						radius = float((bottom_right_x+bottom_right_y-top_left_x-top_left_y)/4)
						writer.writerow([str(flag-2), str(c_x), str(c_y), str(radius), '1'])
				#print(flag)
				if flag == 1:
					print("no apples")
					os.exit()
				flag = 0
				out.close()
			new_csv.close()
		txt.close() 
		print(len(list))			
</code></pre></div></div>

<h3 id="3图像增强水平翻转">3、图像增强（水平翻转）</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import os
		import cv2

		dir = r"test_images/"
		list = os.listdir(dir)
		cnt = 0

		for i in range(0,len(list)):  #len(list)
			img_file_name = list[i]
			print(img_file_name)
			img = cv2.imread(dir+img_file_name)
			new_img = cv2.flip(img, 1)
			cv2.imwrite(r"aug_images_test/"+img_file_name, new_img)
			cnt += 1
		print('all ', cnt)			
</code></pre></div></div>

<h3 id="4计算一幅图像三个颜色通道各自的平均值">4、计算一幅图像三个颜色通道各自的平均值</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import cv2
		import os
		import numpy as np

		dir = r'JPEGImages/'
		list = os.listdir(dir)

		R_sum = 0
		G_sum = 0
		B_sum = 0
		im_num = 0

		for im_name in list:
			im_num += 1
			img = cv2.imread(dir+im_name)
			imgr = img[:,:,2]
			imgg = img[:,:,1]
			imgb = img[:,:,0]
			R_sum += np.sum(imgr) / 308 / 202
			G_sum += np.sum(imgg) / 308 / 202
			B_sum += np.sum(imgb) / 308 / 202
			#print R_sum, G_sum, B_sum
		R_sum /= im_num
		G_sum /= im_num
		B_sum /= im_num
		print R_sum, G_sum, B_sum			
</code></pre></div></div>

<h3 id="5根据csv文件的标签数据在原图上画出标定框">5、根据csv文件的标签数据在原图上画出标定框</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import csv
		import os
		from PIL import Image, ImageDraw

		source_dir = r'apple/'
		dest_dir = r'apple-gt/'

		list = os.listdir(source_dir)
		for file_name in list:
			print file_name
			file_name_no_ext = file_name.rstrip('.png')
			img = Image.open(source_dir+file_name)
			draw = ImageDraw.Draw(img)
			csv_out = open(r'test-annotations-csv/'+file_name_no_ext+'.csv', 'r')
			read_csv = csv.reader(csv_out, dialect='excel')
			csv_line_num = 0
			for line in read_csv:
				if csv_line_num == 0:
					csv_line_num += 1
					continue
				xminT = (int)(float(line[1]) - float(line[3])) if (int)(float(line[1]) - float(line[3])) &gt; 1 else 1
				yminT = (int)(float(line[2]) - float(line[3])) if (int)(float(line[2]) - float(line[3])) &gt; 1 else 1
				xmaxT = (int)(float(line[1]) + float(line[3])) if (int)(float(line[1]) + float(line[3])) &lt; 308 else 308
				ymaxT = (int)(float(line[2]) + float(line[3])) if (int)(float(line[2]) + float(line[3])) &lt; 202 else 202
				draw.rectangle([xminT, yminT, xmaxT, ymaxT], outline=(0, 0, 255))
			csv_out.close()
			img.save(dest_dir+file_name)			
</code></pre></div></div>

<h3 id="6根据txt文件保存了文件名批量复制文件">6、根据txt文件（保存了文件名）批量复制文件</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import os
		import shutil

		dir = r'test-annotations-csv/'
		txt = open(r'ImageSets/Main/test.txt')
		lines = txt.readlines()
		for line in lines:
			line = line.strip('\r\n') + '.csv'
			print(line)
			shutil.copyfile(r'annotations-csv/'+line, dir + line)
		txt.close()			
</code></pre></div></div>

<h3 id="7随机读取txt文件中的若干行">7、随机读取txt文件中的若干行</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import random
		import linecache
		import shutil

		txt = open("random-select/label.txt", 'w')
		resultList=random.sample(range(0,789),150)
		for i in range(0, 150):
			theline = linecache.getline(r'ImageSets/Main/train.txt', resultList[i]).strip('\n')
			print(theline)
			txt.write(theline+'\n')
			shutil.copyfile(r'Annotations/'+theline+'.xml', r"random-select/Annotations/"+theline+'.xml')
			shutil.copyfile(r"JPEGImages/"+theline+'.png', r"random-select/JPEGImages/"+theline+'.png')
		txt.close()			
</code></pre></div></div>

<h3 id="8读取txt文件">8、读取txt文件</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import os

		txt = open(r'test.txt')
		new_txt = open(r'test1.txt', 'w')
		lines = txt.readlines()
		#print lines.strip('\n')
		for line2 in lines:
			new_txt.write(line2.strip('\r\n')+'\n')
		txt.close()
		new_txt.close()			
</code></pre></div></div>

<h3 id="9读取csv文件">9、读取csv文件</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import csv
		import os
		import shutil


		dir = r"annotations-csv/"
		list = os.listdir(dir)

		flag = 0

		for i in range(0,len(list)):  #len(list)
			file_name_no_ext = list[i].rstrip('.csv')
			print(file_name_no_ext)
			path = os.path.join(dir,list[i])
			if os.path.isfile(path):
				out = open(path,'r')
				read_csv = csv.reader(out,dialect='excel')
				for line in read_csv:     #循环输出csv中的所有数据
					if flag == 0:
						flag = flag + 1
						continue
					flag = flag + 1
				if flag &gt; 1:
					shutil.copyfile(path, r"all-have-apples/annotations-csv/"+file_name_no_ext+'.csv')
					shutil.copyfile(r"images/"+file_name_no_ext+'.png', r"all-have-apples/images/"+file_name_no_ext+'.png')
				flag = 0
				out.close()
		print(len(list))			
</code></pre></div></div>

<h3 id="9文件批量重命名000001">9、文件批量重命名（000001.*）</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import os

		for i in range(1870 * 1 + 1, 1870 * 2 + 1):
			index = str(i).zfill(6)
			os.rename('camera4/period14_camera4/%d.png' % i, 'camera4/period14_camera4/%s.png' % index)   #重命名
		print('ok')
		#        print file.split('.')[-1]			
</code></pre></div></div>

<h3 id="10除去txt文件中的空行">10、除去txt文件中的空行</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import sys  

		f=open('tmp.txt', 'r')  
		fnew=open('_new.txt','w') #将结果存入新的文本中 
		lines =  f.readlines()
		for line in lines:   #对每一行先删除空格，\n等无用的字符，再检查此行是否长度为0  
			#print(":"+line)
			if line.strip():   
				fnew.write(line) 
		print('ok')
		f.close()  
		fnew.close() 			
</code></pre></div></div>

<h3 id="11opencv提取前景">11、opencv提取前景</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import numpy as np
		import cv2

		#cap = cv2.VideoCapture('Video_001.avi')
		#cap = cv2.VideoCapture(0)
		kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (3, 3))
		fgbg = cv2.createBackgroundSubtractorMOG2(False)
		cv2.namedWindow("sourceImg")
		cv2.namedWindow("fgmask")
		count = 0
		for i in range(1, 23):
			frame = cv2.imread("ball_annotated/camera1_20080409T183943+02_frame%d.png" % (i))
			#ret, frame = cap.read()
			fgmask = fgbg.apply(frame)
			fgmask = cv2.morphologyEx(fgmask, cv2.MORPH_OPEN, kernel)
			cv2.imshow('sourceImg', frame)
			cv2.imshow('fgmask', fgmask)
			#count = i % 10
			#if not count:
			cv2.imwrite("2.fg/camera1_20080409T183943+02_frame%d_fg.png" % (i), fgmask)
			k = cv2.waitKey(100) &amp; 0xff
			#if k == 27:
				#break
		#cap.release()
		cv2.destroyAllWindows()			
</code></pre></div></div>

<h3 id="12xml文件转换成txt文件">12、xml文件转换成txt文件</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="c">#!/usr/bin/evn python</span>
		<span class="c"># coding:utf-8</span>
		<span class="kn">import</span> <span class="nn">os</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="k">as</span> <span class="n">ET</span>
		<span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
			<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="n">ET</span>
		<span class="kn">import</span> <span class="nn">sys</span>

		<span class="n">xml_dir</span> <span class="o">=</span> <span class="s">r"D:\Python\PythonProjects\333_xml"</span>
		<span class="n">xml_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xml_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">xml_dir</span><span class="p">)</span> <span class="k">if</span>
						 <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xml_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">".xml"</span><span class="p">)]</span>

		<span class="n">strTemp</span> <span class="o">=</span> <span class="s">''</span>  <span class="c"># 将txt文件清空</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xml_dir</span><span class="p">,</span> <span class="s">"mytxt.txt"</span><span class="p">),</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">strTemp</span><span class="p">))</span>

		<span class="k">for</span> <span class="n">xml_path</span> <span class="ow">in</span> <span class="n">xml_paths</span><span class="p">:</span>
			<span class="n">f</span> <span class="o">=</span> <span class="n">xml_path</span>
			<span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c"># 打开xml文档</span>
			<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>  <span class="c"># 获得root节点</span>
			<span class="k">print</span>
			<span class="s">"*"</span> <span class="o">*</span> <span class="mi">10</span>
			<span class="n">filename</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'filename'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
			<span class="c">#filename = filename[:-4]</span>
			<span class="k">print</span>
			<span class="n">filename</span>

			<span class="c">########################################</span>
			<span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'size'</span><span class="p">):</span>  <span class="c"># 找到root节点下的size节点</span>
				<span class="n">width</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'width'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>  <span class="c"># 子节点下节点width的值</span>
				<span class="n">height</span> <span class="o">=</span> <span class="n">size</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'height'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>  <span class="c"># 子节点下节点height的值</span>
				<span class="k">print</span>
				<span class="n">width</span><span class="p">,</span> <span class="n">height</span>
			<span class="c">########################################</span>

			<span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'object'</span><span class="p">):</span>  <span class="c"># 找到root节点下的所有object节点</span>
				<span class="n">name</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'name'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>  <span class="c"># 子节点下节点name的值</span>
				<span class="k">print</span>
				<span class="n">name</span>
				<span class="n">bndbox</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'bndbox'</span><span class="p">)</span>  <span class="c"># 子节点下属性bndbox的值</span>
				<span class="n">xmin</span> <span class="o">=</span> <span class="n">bndbox</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'xmin'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
				<span class="n">ymin</span> <span class="o">=</span> <span class="n">bndbox</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'ymin'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
				<span class="n">xmax</span> <span class="o">=</span> <span class="n">bndbox</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'xmax'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
				<span class="n">ymax</span> <span class="o">=</span> <span class="n">bndbox</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'ymax'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
				<span class="k">print</span>
				<span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span>

			<span class="n">strTemp</span><span class="o">=</span><span class="n">filename</span><span class="o">+</span><span class="s">'.png '</span><span class="o">+</span><span class="s">'basketball'</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ymax</span><span class="p">)</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span>

			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xml_dir</span><span class="p">,</span> <span class="s">"mytxt.txt"</span><span class="p">),</span> <span class="s">"a"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">strTemp</span><span class="p">))</span>			
</code></pre></div></div>

<h3 id="13图像数据增强方法">13、图像数据增强方法</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		# -*- coding:utf-8 -*-  
		"""数据增强 
		   1. 翻转变换 flip 
		   2. 随机修剪 random crop 
		   3. 色彩抖动 color jittering 
		   4. 平移变换 shift 
		   5. 尺度变换 scale 
		   6. 对比度变换 contrast 
		   7. 噪声扰动 noise 
		   8. 旋转变换/反射变换 Rotation/reflection 
		   author: XiJun.Gong 
		   date:2016-11-29 
		"""  

		from PIL import Image, ImageEnhance, ImageOps, ImageFile  
		import numpy as np  
		import random  
		import threading, os, time  
		import logging  
		import cv2  
		logger = logging.getLogger(__name__)  
		ImageFile.LOAD_TRUNCATED_IMAGES = True  


		class DataAugmentation:  
			""" 
			包含数据增强的八种方式 
			"""  


			def __init__(self):  
				pass  

			@staticmethod  
			def openImage(image):  
				return Image.open(image, mode="r")  

			@staticmethod  
			def randomRotation(image, mode=Image.BICUBIC):  
				""" 
				 对图像进行随机任意角度(0~360度)旋转 
				:param mode 邻近插值,双线性插值,双三次B样条插值(default) 
				:param image PIL的图像image 
				:return: 旋转转之后的图像 
				"""  
				random_angle = np.random.randint(1, 360)  
				return image.rotate(random_angle, mode)  
				#return image.rotate(180, mode)  

			@staticmethod  
			def randomFlip(image):  
				#图像翻转（类似于镜像，镜子中的自己）  
				#FLIP_LEFT_RIGHT,左右翻转  
				#FLIP_TOP_BOTTOM,上下翻转  
				#ROTATE_90, ROTATE_180, or ROTATE_270.按照角度进行旋转，与randomRotate()功能类似  
				return image.transpose(Image.FLIP_LEFT_RIGHT)  

			@staticmethod  
			def Tranform(image):  
				#t图像变换  
				#im.transform(size, method, data) ⇒ image  

				#im.transform(size, method, data, filter) ⇒ image  
				#1：image.transform((300,300), Image.EXTENT, (0, 0, 300, 300))   
				#   变量data为指定输入图像中两个坐标点的4元组(x0,y0,x1,y1)。  
				#   输出图像为这两个坐标点之间像素的采样结果。  
				#   例如，如果输入图像的(x0,y0)为输出图像的（0，0）点，(x1,y1)则与变量size一样。  
				#   这个方法可以用于在当前图像中裁剪，放大，缩小或者镜像一个任意的长方形。  
				#   它比方法crop()稍慢，但是与resize操作一样快。  
				#2：image.transform((300,300), Image.AFFINE, (1, 2,3, 2, 1,4))  
				#   变量data是一个6元组(a,b,c,d,e,f)，包含一个仿射变换矩阵的第一个两行。  
				#   输出图像中的每一个像素（x，y），新值由输入图像的位置（ax+by+c, dx+ey+f）的像素产生，  
				#   使用最接近的像素进行近似。这个方法用于原始图像的缩放、转换、旋转和裁剪。  
				#3: image.transform((300,300), Image.QUAD, (0,0,0,500,600,500,600,0))  
				#   变量data是一个8元组(x0,y0,x1,y1,x2,y2,x3,y3)，它包括源四边形的左上，左下，右下和右上四个角。  
				#4: image.transform((300,300), Image.MESH, ())  
				#   与QUAD类似，但是变量data是目标长方形和对应源四边形的list。  
				#5: image.transform((300,300), Image.PERSPECTIVE, (1,2,3,2,1,6,1,2))  
				#   变量data是一个8元组(a,b,c,d,e,f,g,h)，包括一个透视变换的系数。  
				#   对于输出图像中的每个像素点，新的值来自于输入图像的位置的(a x + b y + c)/(g x + h y + 1),  
				#   (d x+ e y + f)/(g x + h y + 1)像素，使用最接近的像素进行近似。  
				#   这个方法用于原始图像的2D透视。  
				return image.transform((300,300), Image.EXTENT, (0, 0, 300, 300))  

			@staticmethod  
			def randomCrop(image):  
				""" 
				对图像随意剪切,考虑到图像大小范围(68,68),使用一个一个大于(36*36)的窗口进行截图 
				:param image: PIL的图像image 
				:return: 剪切之后的图像 

				"""  
				image_width = image.size[0]  
				image_height = image.size[1]  
				crop_win_size = np.random.randint(40, 68)  
				random_region = (  
					(image_width - crop_win_size) &gt;&gt; 1, (image_height - crop_win_size) &gt;&gt; 1, (image_width + crop_win_size) &gt;&gt; 1,  
					(image_height + crop_win_size) &gt;&gt; 1)  
				return image.crop(random_region)  

			@staticmethod  
			def randomColor(image):  
				""" 
				对图像进行颜色抖动 
				:param image: PIL的图像image 
				:return: 有颜色色差的图像image 
				"""  
				random_factor = np.random.randint(0, 31) / 10.  # 随机因子  
				color_image = ImageEnhance.Color(image).enhance(random_factor)  # 调整图像的饱和度  
				random_factor = np.random.randint(10, 21) / 10.  # 随机因子  
				brightness_image = ImageEnhance.Brightness(color_image).enhance(random_factor)  # 调整图像的亮度  
				random_factor = np.random.randint(10, 21) / 10.  # 随机因1子  
				contrast_image = ImageEnhance.Contrast(brightness_image).enhance(random_factor)  # 调整图像对比度  
				random_factor = np.random.randint(0, 31) / 10.  # 随机因子  
				return ImageEnhance.Sharpness(contrast_image).enhance(random_factor)  # 调整图像锐度  

			@staticmethod  
			def randomGaussian(image, mean=0.2, sigma=0.3):  
				""" 
				 对图像进行高斯噪声处理 
				:param image: 
				:return: 
				"""  

				def gaussianNoisy(im, mean=0.2, sigma=0.3):  
					""" 
					对图像做高斯噪音处理 
					:param im: 单通道图像 
					:param mean: 偏移量 
					:param sigma: 标准差 
					:return: 
					"""  
					for _i in range(len(im)):  
						im[_i] += random.gauss(mean, sigma)  
					return im  

				# 将图像转化成数组  
				img = np.asarray(image)  
				img.flags.writeable = True  # 将数组改为读写模式  
				width, height = img.shape[:2]  
				img_r = gaussianNoisy(img[:, :, 0].flatten(), mean, sigma)  
				img_g = gaussianNoisy(img[:, :, 1].flatten(), mean, sigma)  
				img_b = gaussianNoisy(img[:, :, 2].flatten(), mean, sigma)  
				img[:, :, 0] = img_r.reshape([width, height])  
				img[:, :, 1] = img_g.reshape([width, height])  
				img[:, :, 2] = img_b.reshape([width, height])  
				return Image.fromarray(np.uint8(img))  

			@staticmethod  
			def saveImage(image, path):  
				image.save(path)  


		def makeDir(path):  
			try:  
				if not os.path.exists(path):  
					if not os.path.isfile(path):  
						# os.mkdir(path)  
						os.makedirs(path)  
					return 0  
				else:  
					return 1  
			except Exception, e:  
				print str(e)  
				return -2  


		def imageOps(func_name, image, des_path, file_name, times=5):  
			#funcMap = {"randomRotation": DataAugmentation.randomRotation,  
			#           "randomCrop": DataAugmentation.randomCrop,  
			#           "randomColor": DataAugmentation.randomColor,  
			#           "randomGaussian": DataAugmentation.randomGaussian  
			#           "randomFlip":DataAugmentation.randomFlip,  
			#           }  
			funcMap = {  
					   "Tranform":DataAugmentation.Tranform  
					   }  
			if funcMap.get(func_name) is None:  
				logger.error("%s is not exist", func_name)  
				return -1  

			for _i in range(0, times, 1):  
				new_image = funcMap[func_name](image)  
				DataAugmentation.saveImage(new_image, os.path.join(des_path, func_name + str(_i) + file_name))  


		#opsList = {"randomFlip","randomRotation", "randomCrop", "randomColor", "randomGaussian"}  
		opsList = { "Tranform"}  

		def threadOPS(path, new_path):  
			""" 
			多线程处理事务 
			:param src_path: 资源文件 
			:param des_path: 目的地文件 
			:return: 
			"""  
			if os.path.isdir(path):  
				img_names = os.listdir(path)  
			else:  
				img_names = [path]  
			for img_name in img_names:  
				print img_name  
				tmp_img_name = os.path.join(path, img_name)  
				if os.path.isdir(tmp_img_name):  
					if makeDir(os.path.join(new_path, img_name)) != -1:  
						threadOPS(tmp_img_name, os.path.join(new_path, img_name))  
					else:  
						print 'create new dir failure'  
						return -1  
						# os.removedirs(tmp_img_name)  
				elif tmp_img_name.split('.')[1] != "DS_Store":  
					# 读取文件并进行操作  
					image = DataAugmentation.openImage(tmp_img_name)  
					threadImage = [0] * 5  
					_index = 0  
					for ops_name in opsList:  
						threadImage[_index] = threading.Thread(target=imageOps,  
															   args=(ops_name, image, new_path, img_name,))  
						threadImage[_index].start()  
						_index += 1  
						time.sleep(0.2)  


		if __name__ == '__main__':  
			threadOPS("D:\datasets\dataArgument\JPEGImages",  
					  "D:\datasets\dataArgument\Dealed_JPEGImages")  		
</code></pre></div></div>

<h3 id="14从一个voc数据集创建多个训练子集只改变训练样本的数量">14、从一个VOC数据集创建多个训练子集（只改变训练样本的数量）</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		import random 
		import linecache
		import shutil
		import os

		source_txt_dir = r'ImageSets/Main/'
		source_annotations_dir = r'Annotations/'
		source_images_dir = r'JPEGImages/'
		dest_root_dir = r'manyDatasets/'

		for image_num in range(50, 751, 50):

			#create dir
			one_dataset_dir = dest_root_dir + str(image_num)
			Annotations_dir = one_dataset_dir+'/Annotations/'
			ImageSets_dir_up = one_dataset_dir+'/ImageSets/'
			ImageSets_dir = one_dataset_dir+'/ImageSets/Main/'
			JPEGImages_dir = one_dataset_dir+'/JPEGImages/'

			is_exist_dir = os.path.exists(one_dataset_dir)  #dataset dir
			if not is_exist_dir:
				os.mkdir(one_dataset_dir)
			is_exist_dir = os.path.exists(Annotations_dir)  #Annotations dir
			if not is_exist_dir:
				os.mkdir(Annotations_dir)
			is_exist_dir = os.path.exists(ImageSets_dir_up)  #ImageSets dir
			if not is_exist_dir:
				os.mkdir(ImageSets_dir_up)
				is_exist_dir = os.path.exists(ImageSets_dir)  #ImageSets dir
			if not is_exist_dir:
				os.mkdir(ImageSets_dir)
			is_exist_dir = os.path.exists(JPEGImages_dir)  #JPEGImages dir
			if not is_exist_dir:
				os.mkdir(JPEGImages_dir)

			#create new train.txt trainval.txt
			new_train = open(ImageSets_dir+'train.txt', 'w')
			new_trainval = open(ImageSets_dir+'trainval.txt', 'w')

			#read source train.txt
			result_list = random.sample(range(1, 789), image_num)  #image_num
			for i in range(0, image_num):
				file_name_no_ext = linecache.getline(source_txt_dir+'train.txt', result_list[i]).rstrip('\r\n')
				print file_name_no_ext

				#write train.txt
				new_train.write(file_name_no_ext+'\n')
				new_trainval.write(file_name_no_ext+'\n')

				#copy annotations file
				shutil.copyfile(source_annotations_dir+file_name_no_ext+'.xml', Annotations_dir+file_name_no_ext+'.xml')
				#copy images
				shutil.copyfile(source_images_dir+file_name_no_ext+'.png', JPEGImages_dir+file_name_no_ext+'.png')

			new_train.close()
			#write test.txt
			source_test = open(source_txt_dir+'test.txt', 'r')
			new_test = open(ImageSets_dir+'test.txt', 'w')
			lines = source_test.readlines()
			for line in lines:
				new_test.write(line.rstrip('\r\n')+'\n')
				#copy annotations file
				shutil.copyfile(source_annotations_dir+line.rstrip('\r\n')+'.xml', Annotations_dir+line.rstrip('\r\n')+'.xml')
				#copy images
				shutil.copyfile(source_images_dir+line.rstrip('\r\n')+'.png', JPEGImages_dir+line.rstrip('\r\n')+'.png')
			source_test.close()
			new_test.close()

			#write val.txt
			source_val = open(source_txt_dir+'val.txt', 'r')
			new_val = open(ImageSets_dir+'val.txt', 'w')
			lines = source_val.readlines()
			for line in lines:
				new_val.write(line.rstrip('\r\n')+'\n')
				#copy annotations file
				shutil.copyfile(source_annotations_dir+line.rstrip('\r\n')+'.xml', Annotations_dir+line.rstrip('\r\n')+'.xml')
				#copy images
				shutil.copyfile(source_images_dir+line.rstrip('\r\n')+'.png', JPEGImages_dir+line.rstrip('\r\n')+'.png')
			source_val.close()
			new_val.close()

			val = open(ImageSets_dir+'val.txt', 'r')
			lines = val.readlines()
			for line in lines:
				new_trainval.write(line.rstrip('\r\n')+'\n')    #copy val to trainval
			val.close()
			new_trainval.close()				
</code></pre></div></div>


    <hr style="border-top:1px solid #28323C;"/>

    <!-- tags and categories under post -->
    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-folder-open"></i></li>
      
      
         
            <li class="icon-style"><a href="/categories.html">
                Material <span>(3)</span>
                
            </a></li>
        
      
    </ul>
      

    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-tags"></i></li>
      
      
         
            <li class="icon-style">
                <a href="/tags.html">
                Python <span>(2)</span>
                
                </a>
            </li>
        
      
      
    </ul>
      

    </div>
    
</div>
<div class="pagination">
    
    <a class="btn btn-default" href="/paper/2018/03/03/detection-papers-note.html" class="next">Newer Post</a>
    
    
    <a class="btn btn-default" href="/paper/2018/01/19/rcnn-small-object.html" class="previous">Older Post</a>
    
</div>
            </div>
        </div>
    </div>

    
<div class="footer">
    <p>&copy;2018 weiSupreme , Powered by
            
                <a href="http://jekyllrb.com/">
                Jekyll
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="http://getbootstrap.com/">
                Bootstrap
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/">
                Github
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/scotte/jekyll-clean">
                Clean Theme
                </a>
                <!-- not the last, output a ',' -->
                
            
    </p>
</div>

<!-- 
    

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

 
-->

</body>
</html>

</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120200144-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120200144-1');
</script>
</body>