<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>最炫的民族风</title>
	<link rel="icon" href="/assets/images/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css">
    <![endif]-->
    <!--[if lt IE 9]>
       <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
       <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <link href="/assets/css/main.css" rel="stylesheet" type="text/css">


</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="navbar navbar-custom navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">最炫的民族风</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    
                    
                    <li class="active"><a href="/">Home</a></li>
                    <li class="active"><a href="/
archive.html">Archive</a></li>
                    <li class="active"><a href="/categories.html">Categories</a></li>
                    <li class="active"><a href="/tags.html">Tags</a></li>
                    <li class="active"><a href="/about.html">About</a></li>
<img src="/assets/images/me.gif"
                </ul>
            </div>
        </div>
    </div>
</div>


<div class="wrap">
    <div class="container container-left">
        <div class="row">
            <div class="col-md-3 hidden-xs">
                
<div class="sidebar well">
    <header class="sidebar-header" role="banner">
        <a href="/"> 
            <img src="/assets/images/logo.png" class="img-circle" />
        </a>
        <!--
        <h3 class="title">
        <a href="/"></a>
        </h3>
        -->
    </header>
    <div class="text-center">
        zhuwei的个人网站！
    </div>
</div>


<div class="sidebar well">
    <h1>Top Posts</h1>
    <ul>
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/material/2017/11/08/Deep-Learning-materials.html">深度学习入门资料汇总</a></li>
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
                    <li><a href="/programmer/2017/11/08/caffe-installation-without-gpu.html">caffe的安装步骤（无GPU版）</a></li>
                
            
                
            
                
            
                
            
                
            
        
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
                
            
        
    </ul>
</div>


<div class="sidebar well">
    <h1>Recent Posts</h1>
    <ul>
        
          <li><a href="/programmer/2017/12/26/train-with-fasterRcnn.html">创建VOC2007格式数据集用于训练faster-rcnn</a></li>
        
          <li><a href="/programmer/2017/12/03/subtractor-of-opencv.html">实现opencv的背景分离例程</a></li>
        
          <li><a href="/programmer/2017/12/03/change-files-name.html">批量修改文件名</a></li>
        
          <li><a href="/programmer/2017/11/15/create-file-list.html">给文件夹里的图片创建用于caffe的文件列表</a></li>
        
          <li><a href="/programmer/2017/11/14/python-split-space.html">python合并Txt中的空格</a></li>
        
    </ul>
</div>

<div class="sidebar well">
    
<h1>Links</h1>
<ul>
  <!-- <li><a href="#">One</a></li>
  <li><a href="#">Two</a></li>
  <li><a href="#">Three</a></li>
  <li><a href="#">Four</a></li> -->
  
  <li>
    <a href="https://github.com/weiSupreme">
      projects
    </a>
  </li> 
  
  <li>
    <a href="http://blog.csdn.net/wei_supreme">
      CSDN博客
    </a>
  </li> 
  
  <li>
    <a href="http://www.pchou.info/ssgithubPage/2013-01-03-build-github-blog-page-01.html">
      githubPages
    </a>
  </li> 
  
</ul>

</div>

<div class="sidebar well">
    <img src="/assets/images/666.gif" class="img-circle" />
</div>

            </div>
            <div class="col-md-9">
                
<div class="well article">
        <h2><a href="/programmer/2017/01/24/upper-computer-with-C-via-usb_hid.html">C#上位机之USB_Hid通信</a></h2>
        <span class="post-date">
            
            2017年-01月-24日
        </span>
        <hr style="border-top:1px solid #28323C;"/>
    
    <div class="post-content">
    <div class="highlighter-rouge"><pre class="highlight"><code>   最近在写上位机，用到了hid通信，在网上查找了很多资料，终于通信成功。其中也遇到了一些问题，在此说明一下，希望可以帮到有需要的朋友。 ---
    我是在网上找到了一个例程，将其移植了一下。开始接收数据没问题，但是发送数据一直不成功，只有在一次性发送到数据大于64个字节是才会发送，而且接收下位机发送回来的相同的数据也不对。折磨了我好几天，终于在谷歌上搜到了相关信息。原来hid的report是有固定格式的。发送数据的时候，数组第一个byte是hid 的report id，一般是0；数组第二个byte是要发送的数据的长度。同样的，接收到的数据，缓冲区里第一个byte是id,，也就是0；第二个byte是接收到的数据的长度。我在网上搜索到的例程中并不是这样的，他直接把缓冲区的数据全当作是接收到的数据，发送的时候也是直接发送数据，没有按照report的格式，所以导致我通信不成功。一开始接收数据时，由于下位机发送到数据是有固定格式的，所以没有分离出id和数据长度也没有影响。
   附件里是我修改过的例程，并且也多次测试过，发送和接收都没有问题，有需要的朋友可以下载参考。我这里再单独提一下这个report的问题。 --- 接收数据：

    private void ReadCompleted(IAsyncResult iResult)
    {
        byte[] readBuff = (byte[])(iResult.AsyncState);
        try
        {
            hidDevice.EndRead(iResult);//读取结束,如果读取错误就会产生一个异常
            byte[] reportData = new byte[readBuff.Length - 2];  ////////////////////////////////////////////第一个byte是id，第二个byte是数据长度，所以从readbuff[2]开始才是真正接收到的数据
            for (int i = 2; i &lt; readBuff.Length; i++)
                reportData[i - 2] = readBuff[i];
            report e = new report(readBuff[0], reportData);
            OnDataReceived(e); //发出数据到达消息
            BeginAsyncRead();//启动下一次读操作
        }
        catch (IOException)//读写错误,设备已经被移除
        {
            EventArgs ex = new EventArgs();
            OnDeviceRemoved(ex);//发出设备移除消息
            CloseDevice();
        }
    } 发送数据：

    internal string WriteUSBHID(string sendValue)
    {
        try
        {
            //byte[] array = { 0xF5, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01 };
            byte[] array = System.Text.ASCIIEncoding.Default.GetBytes(sendValue);
            byte[] arr = new byte[outputReportLength]; ////////////////////////////////////////////////////////////这里注意：要发送的arr数组大小必须是outputReportLength
            arr[0] = 0x00;   /////////////////////////////////////第一个是id
            arr[1] = (byte)array.Length;////////////////////////////////第二个是数据长度
            for (int i = 2; i &lt; array.Length + 2; i++)
            {
                arr[i] = array[i - 2];
            }
            hidDevice.Write(arr, 0, arr.Length);  ///////////////////////////////原例程是直接发送array数组，导致通信失败
            return sendValue;
        }
        catch (Exception e) {
            return e.Message ;
        }
    } ---
   最后，感谢原例程的作者，还要感谢伟大的谷歌（我是输入英文查找的。百度上搜索的都是你抄我，我抄你的，没有人讲这个问题，也不知道是就我一个人遇到了，还是大家解决了不屑说又或者太保守不想告诉别人，唉！吐槽一下，请勿见怪。）
     再附上百度云链接：链接：http://pan.baidu.com/s/1qYIZXrY 密码：85hq  ；链接：http://pan.baidu.com/s/1kU6cE0Z 密码：g8r2
</code></pre>
</div>

    <hr style="border-top:1px solid #28323C;"/>

    <!-- tags and categories under post -->
    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-folder-open"></i></li>
      
      
         
            <li class="icon-style"><a href="/categories.html">
                Programmer <span>(12)</span>
                
            </a></li>
        
      
    </ul>
      

    
    <ul class="list-unstyled list-inline">
      <li><i class="icon-tags"></i></li>
      
      
         
            <li class="icon-style">
                <a href="/tags.html">
                C# <span>(1)</span>
                ,
                </a>
            </li>
         
            <li class="icon-style">
                <a href="/tags.html">
                上位机 <span>(1)</span>
                
                </a>
            </li>
        
      
      
    </ul>
      

    </div>
    
</div>
<div class="pagination">
    
    <a class="btn btn-default" href="/programmer/2017/09/11/hello-world-of-github-pages.html" class="next">Newer Post</a>
    
    
    <a class="btn btn-default" href="/programmer/2016/05/27/PX4-notes-uorb.html" class="previous">Older Post</a>
    
</div>
            </div>
        </div>
    </div>

    
<div class="footer">
    <p>&copy;2017 最炫的民族风 , Powered by
            
                <a href="http://jekyllrb.com/">
                Jekyll
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="http://getbootstrap.com/">
                Bootstrap
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/">
                Github
                </a>
                <!-- not the last, output a ',' -->
                
                ,
                
            
                <a href="https://github.com/scotte/jekyll-clean">
                Clean Theme
                </a>
                <!-- not the last, output a ',' -->
                
            
    </p>
</div>

<!-- 
    

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '', 'auto');
    ga('send', 'pageview');
  </script>

 
-->

</body>
</html>

</div>